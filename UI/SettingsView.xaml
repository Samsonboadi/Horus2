<UserControl x:Class="Test.UI.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="600"
             MinWidth="500">

    <UserControl.Resources>
        <!-- ArcGIS Pro Professional Color Palette -->
        <SolidColorBrush x:Key="EsriBlue" Color="#0079C1"/>
        <SolidColorBrush x:Key="EsriLightBlue" Color="#00A9CE"/>
        <SolidColorBrush x:Key="EsriDarkBlue" Color="#004874"/>
        <SolidColorBrush x:Key="EsriGray" Color="#6D6E71"/>
        <SolidColorBrush x:Key="EsriLightGray" Color="#D1D3D4"/>
        <SolidColorBrush x:Key="EsriBackground" Color="#F7F8F8"/>
        <SolidColorBrush x:Key="EsriWhite" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="EsriDarkGray" Color="#323334"/>
        <SolidColorBrush x:Key="EsriSuccess" Color="#5CA05B"/>
        <SolidColorBrush x:Key="EsriWarning" Color="#FF7F00"/>
        <SolidColorBrush x:Key="EsriError" Color="#DE2900"/>

        <!-- Professional Button Styles -->
        <Style x:Key="EsriButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource EsriBlue}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource EsriBlue}"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="MinHeight" Value="24"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="2"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource EsriLightBlue}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource EsriDarkBlue}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EsriSecondaryButton" TargetType="Button" BasedOn="{StaticResource EsriButton}">
            <Setter Property="Background" Value="{StaticResource EsriWhite}"/>
            <Setter Property="Foreground" Value="{StaticResource EsriDarkGray}"/>
            <Setter Property="BorderBrush" Value="{StaticResource EsriLightGray}"/>
        </Style>

        <!-- Professional TextBox Style -->
        <Style x:Key="EsriTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource EsriWhite}"/>
            <Setter Property="BorderBrush" Value="{StaticResource EsriLightGray}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="MinHeight" Value="24"/>
        </Style>

        <!-- Professional PasswordBox Style -->
        <Style x:Key="EsriPasswordBox" TargetType="PasswordBox">
            <Setter Property="Background" Value="{StaticResource EsriWhite}"/>
            <Setter Property="BorderBrush" Value="{StaticResource EsriLightGray}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="MinHeight" Value="24"/>
        </Style>

        <!-- Professional GroupBox Style -->
        <Style x:Key="EsriGroupBox" TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="{StaticResource EsriLightGray}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource EsriDarkGray}"/>
            <Setter Property="Background" Value="{StaticResource EsriWhite}"/>
        </Style>

        <!-- Professional Label Style -->
        <Style x:Key="EsriLabel" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource EsriDarkGray}"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>

        <!-- Professional CheckBox Style -->
        <Style x:Key="EsriCheckBox" TargetType="CheckBox">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource EsriDarkGray}"/>
        </Style>
    </UserControl.Resources>

    <Grid Background="{StaticResource EsriBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Professional Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource EsriDarkGray}" 
                BorderBrush="{StaticResource EsriGray}" 
                BorderThickness="0,0,0,1"
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" 
                        Content="← Back" 
                        Style="{StaticResource EsriSecondaryButton}"
                        Command="{Binding CloseSettingsCommand}"
                        Background="Transparent"
                        BorderBrush="{StaticResource EsriGray}"
                        Foreground="White"
                        FontSize="11"
                        Padding="8,4"/>

                <TextBlock Grid.Column="1"
                           Text="Spherical Image Viewer - Settings" 
                           Foreground="White" 
                           FontFamily="Segoe UI"
                           FontSize="14" 
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="Apply" 
                            Style="{StaticResource EsriButton}"
                            Command="{Binding SaveSettingsCommand}"
                            FontSize="11"
                            Padding="12,4"
                            Margin="0,0,4,0"/>
                    <Button Content="Reset" 
                            Style="{StaticResource EsriSecondaryButton}"
                            Command="{Binding ResetSettingsCommand}"
                            Background="Transparent"
                            BorderBrush="{StaticResource EsriGray}"
                            Foreground="White"
                            FontSize="11"
                            Padding="8,4"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="12">
            <StackPanel>

                <!-- Server Connection Settings -->
                <GroupBox Header="Server Connection" Style="{StaticResource EsriGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Server URL -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Server URL:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding ServerUrl}" 
                                     Style="{StaticResource EsriTextBox}"
                                     Margin="0,0,8,0"
                                     ToolTip="Full URL including protocol (e.g., http://192.168.6.100:5050)"/>
                            <Button Grid.Column="2" 
                                    Content="Test" 
                                    Style="{StaticResource EsriSecondaryButton}"
                                    Command="{Binding TestConnectionCommand}"
                                    MinWidth="60"/>
                        </Grid>

                        <!-- Connection Status -->
                        <Grid Grid.Row="1" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Status:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                <Ellipse Width="12" Height="12" Margin="0,0,8,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="{StaticResource EsriError}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                                    <Setter Property="Fill" Value="{StaticResource EsriSuccess}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                                <TextBlock VerticalAlignment="Center" 
                                           FontFamily="Segoe UI"
                                           FontSize="12">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Disconnected"/>
                                            <Setter Property="Foreground" Value="{StaticResource EsriError}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                                    <Setter Property="Text" Value="Connected"/>
                                                    <Setter Property="Foreground" Value="{StaticResource EsriSuccess}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Grid>

                        <!-- Auto-connect -->
                        <Grid Grid.Row="2" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Auto-connect:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>

                            <CheckBox Grid.Column="1" 
                                      IsChecked="{Binding AutoConnect}"
                                      Style="{StaticResource EsriCheckBox}"
                                      Content="Automatically connect when add-in starts"
                                      VerticalAlignment="Center"/>
                        </Grid>

                        <!-- Connection Timeout -->
                        <Grid Grid.Row="3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Timeout:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <Slider Grid.Column="1" 
                                    Minimum="5" Maximum="60" 
                                    Value="{Binding ConnectionTimeout}"
                                    TickFrequency="5"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding ConnectionTimeout, StringFormat='{}{0} sec'}" 
                                     Style="{StaticResource EsriTextBox}"
                                     IsReadOnly="True"
                                     Background="{StaticResource EsriBackground}"
                                     TextAlignment="Center"/>
                        </Grid>
                    </Grid>
                </GroupBox>

                <!-- Section-Based Viewer Preferences -->
                <GroupBox Header="Section-Based Viewer" Style="{StaticResource EsriGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Section Count -->
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="220"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Section count:" Style="{StaticResource EsriLabel}" VerticalAlignment="Center"/>
                            <Slider Grid.Column="1" Minimum="1" Maximum="64" Value="{Binding SectionCount}" TickFrequency="1" IsSnapToTickEnabled="True" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" Text="{Binding SectionCount}" Style="{StaticResource EsriTextBox}" IsReadOnly="True" Background="{StaticResource EsriBackground}" TextAlignment="Center"/>
                        </Grid>

                        <!-- Preferred Section -->
                        <Grid Grid.Row="1" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="220"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Preferred section:" Style="{StaticResource EsriLabel}" VerticalAlignment="Center"/>
                            <Slider Grid.Column="1" Minimum="0" Maximum="64" Value="{Binding PreferredSectionIndex}" TickFrequency="1" IsSnapToTickEnabled="True" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" Text="{Binding PreferredSectionIndex}" Style="{StaticResource EsriTextBox}" IsReadOnly="True" Background="{StaticResource EsriBackground}" TextAlignment="Center"/>
                        </Grid>

                        <!-- Default Image Scale -->
                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="220"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Default image scale:" Style="{StaticResource EsriLabel}" VerticalAlignment="Center"/>
                            <Slider Grid.Column="1" Minimum="1" Maximum="6" Value="{Binding DefaultImageScale}" TickFrequency="1" IsSnapToTickEnabled="True" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" Text="{Binding DefaultImageScale}" Style="{StaticResource EsriTextBox}" IsReadOnly="True" Background="{StaticResource EsriBackground}" TextAlignment="Center"/>
                        </Grid>
                    </Grid>
                </GroupBox>

                <!-- Database Connection Settings -->
                <GroupBox Header="Database Connection" Style="{StaticResource EsriGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Database Host -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Host:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding DatabaseHost}" 
                                     Style="{StaticResource EsriTextBox}"
                                     Margin="0,0,8,0"
                                     ToolTip="Database server host (e.g., localhost or IP address)"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding DatabasePort}" 
                                     Style="{StaticResource EsriTextBox}"
                                     ToolTip="Port number"/>
                        </Grid>

                        <!-- Database Name -->
                        <Grid Grid.Row="1" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Database:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding DatabaseName}" 
                                     Style="{StaticResource EsriTextBox}"/>
                        </Grid>

                        <!-- Database User -->
                        <Grid Grid.Row="2" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Username:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding DatabaseUser}" 
                                     Style="{StaticResource EsriTextBox}"/>
                        </Grid>

                        <!-- Database Password -->
                        <Grid Grid.Row="3" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Password:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <PasswordBox x:Name="DatabasePasswordBox"
                                         Grid.Column="1" 
                                         Style="{StaticResource EsriPasswordBox}"
                                         PasswordChanged="DatabasePasswordBox_PasswordChanged"/>
                        </Grid>

                        <!-- Database Connection Status and Test -->
                        <Grid Grid.Row="4" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="DB Status:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                <Ellipse Width="12" Height="12" Margin="0,0,8,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="{StaticResource EsriError}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsDatabaseConnected}" Value="True">
                                                    <Setter Property="Fill" Value="{StaticResource EsriSuccess}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                                <TextBlock VerticalAlignment="Center" 
                                           FontFamily="Segoe UI"
                                           FontSize="12">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Not Connected"/>
                                            <Setter Property="Foreground" Value="{StaticResource EsriError}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsDatabaseConnected}" Value="True">
                                                    <Setter Property="Text" Value="Connected"/>
                                                    <Setter Property="Foreground" Value="{StaticResource EsriSuccess}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>

                            <Button Grid.Column="2" 
                                    Content="Test DB" 
                                    Style="{StaticResource EsriSecondaryButton}"
                                    Command="{Binding TestDatabaseConnectionCommand}"
                                    MinWidth="80"/>
                        </Grid>

                        <!-- Recording Endpoint and Horus Client URL -->
                        <Grid Grid.Row="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                       Text="Recording:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0,0,0,8"/>
                            <TextBox Grid.Row="0" Grid.Column="1" 
                                     Text="{Binding RecordingEndpoint}" 
                                     Style="{StaticResource EsriTextBox}"
                                     Margin="0,0,0,8"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" 
                                       Text="Horus URL:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <TextBox Grid.Row="1" Grid.Column="1" 
                                     Text="{Binding HorusClientUrl}" 
                                     Style="{StaticResource EsriTextBox}"/>
                        </Grid>
                    </Grid>
                </GroupBox>

                <!-- Image Settings -->
                <GroupBox Header="Image Settings" Style="{StaticResource EsriGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Default Directory -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Default Directory:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding DefaultImageDirectory}" 
                                     Style="{StaticResource EsriTextBox}"
                                     Margin="0,0,8,0"/>
                            <Button Grid.Column="2" 
                                    Content="Browse..." 
                                    Style="{StaticResource EsriSecondaryButton}"
                                    Command="{Binding BrowseDirectoryCommand}"
                                    MinWidth="80"/>
                        </Grid>

                        <!-- Supported Formats -->
                        <Grid Grid.Row="1" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="File Formats:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding SupportedFormats}" 
                                     Style="{StaticResource EsriTextBox}"
                                     ToolTip="Comma-separated file extensions (e.g., *.jpg,*.png,*.jpeg)"/>
                        </Grid>

                        <!-- Max Images -->
                        <Grid Grid.Row="2" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Max Images:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <Slider Grid.Column="1" 
                                    Minimum="10" Maximum="10000" 
                                    Value="{Binding MaxImagesToLoad}"
                                    TickFrequency="100"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding MaxImagesToLoad}" 
                                     Style="{StaticResource EsriTextBox}"
                                     IsReadOnly="True"
                                     Background="{StaticResource EsriBackground}"
                                     TextAlignment="Center"/>
                        </Grid>

                        <!-- Include Subdirectories -->
                        <Grid Grid.Row="3" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Subdirectories:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>

                            <CheckBox Grid.Column="1" 
                                      IsChecked="{Binding IncludeSubdirectories}"
                                      Style="{StaticResource EsriCheckBox}"
                                      Content="Include images in subdirectories"
                                      VerticalAlignment="Center"/>
                        </Grid>

                        <!-- Image Dimensions -->
                        <Grid Grid.Row="4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Image Size:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="W:" Style="{StaticResource EsriLabel}" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DefaultImageWidth}" 
                                         Style="{StaticResource EsriTextBox}"
                                         Width="60"/>
                            </StackPanel>

                            <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="H:" Style="{StaticResource EsriLabel}" Margin="0,0,4,0"/>
                                <TextBox Text="{Binding DefaultImageHeight}" 
                                         Style="{StaticResource EsriTextBox}"
                                         Width="60"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </GroupBox>

                <!-- Camera Defaults -->
                <GroupBox Header="Camera Defaults" Style="{StaticResource EsriGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Default Yaw -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Default Yaw:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <Slider Grid.Column="1" 
                                    Minimum="-180" Maximum="180" 
                                    Value="{Binding DefaultYaw}"
                                    TickFrequency="45"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding DefaultYaw, StringFormat='{}{0:F0}°'}" 
                                     Style="{StaticResource EsriTextBox}"
                                     IsReadOnly="True"
                                     Background="{StaticResource EsriBackground}"
                                     TextAlignment="Center"/>
                        </Grid>

                        <!-- Default Pitch -->
                        <Grid Grid.Row="1" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Default Pitch:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <Slider Grid.Column="1" 
                                    Minimum="-90" Maximum="90" 
                                    Value="{Binding DefaultPitch}"
                                    TickFrequency="30"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding DefaultPitch, StringFormat='{}{0:F0}°'}" 
                                     Style="{StaticResource EsriTextBox}"
                                     IsReadOnly="True"
                                     Background="{StaticResource EsriBackground}"
                                     TextAlignment="Center"/>
                        </Grid>

                        <!-- Default Roll -->
                        <Grid Grid.Row="2" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Default Roll:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <Slider Grid.Column="1" 
                                    Minimum="-180" Maximum="180" 
                                    Value="{Binding DefaultRoll}"
                                    TickFrequency="45"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding DefaultRoll, StringFormat='{}{0:F0}°'}" 
                                     Style="{StaticResource EsriTextBox}"
                                     IsReadOnly="True"
                                     Background="{StaticResource EsriBackground}"
                                     TextAlignment="Center"/>
                        </Grid>

                        <!-- Default FOV -->
                        <Grid Grid.Row="3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Default FOV:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <Slider Grid.Column="1" 
                                    Minimum="30" Maximum="180" 
                                    Value="{Binding DefaultFov}"
                                    TickFrequency="30"
                                    IsSnapToTickEnabled="True"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding DefaultFov, StringFormat='{}{0:F0}°'}" 
                                     Style="{StaticResource EsriTextBox}"
                                     IsReadOnly="True"
                                     Background="{StaticResource EsriBackground}"
                                     TextAlignment="Center"/>
                        </Grid>
                    </Grid>
                </GroupBox>

                <!-- AI Settings -->
                <GroupBox Header="AI Detection Settings" Style="{StaticResource EsriGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Default Model -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Default Model:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <ComboBox Grid.Column="1" 
                                      ItemsSource="{Binding AvailableModels}" 
                                      SelectedItem="{Binding DefaultModel}"
                                      FontFamily="Segoe UI"
                                      FontSize="12"
                                      Height="24"/>
                        </Grid>

                        <!-- Default Detection Target -->
                        <Grid Grid.Row="1" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Default Target:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding DefaultDetectionTarget}" 
                                     Style="{StaticResource EsriTextBox}"
                                     ToolTip="Default object to search for (e.g., pole, sign, vehicle)"/>
                        </Grid>

                        <!-- Confidence Threshold -->
                        <Grid Grid.Row="2" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="Confidence:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <Slider Grid.Column="1" 
                                    Minimum="0.1" Maximum="1.0" 
                                    Value="{Binding DefaultConfidenceThreshold}"
                                    TickFrequency="0.1"
                                    IsSnapToTickEnabled="False"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding DefaultConfidenceThreshold, StringFormat=P0}" 
                                     Style="{StaticResource EsriTextBox}"
                                     IsReadOnly="True"
                                     Background="{StaticResource EsriBackground}"
                                     TextAlignment="Center"/>
                        </Grid>

                        <!-- IoU Threshold -->
                        <Grid Grid.Row="3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="IoU Threshold:" 
                                       Style="{StaticResource EsriLabel}"
                                       VerticalAlignment="Center"
                                       Margin="0"/>
                            <Slider Grid.Column="1" 
                                    Minimum="0.1" Maximum="1.0" 
                                    Value="{Binding DefaultIoUThreshold}"
                                    TickFrequency="0.1"
                                    IsSnapToTickEnabled="False"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" 
                                     Text="{Binding DefaultIoUThreshold, StringFormat=P0}" 
                                     Style="{StaticResource EsriTextBox}"
                                     IsReadOnly="True"
                                     Background="{StaticResource EsriBackground}"
                                     TextAlignment="Center"/>
                        </Grid>
                    </Grid>
                </GroupBox>

                <!-- WFS & Map Preferences -->
                <GroupBox Header="WFS &amp; Map Preferences" Style="{StaticResource EsriGroupBox}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <CheckBox Grid.Row="0"
                                  Content="Auto-refresh WFS when map view changes"
                                  IsChecked="{Binding AutoRefreshWfsOnViewChange}"
                                  Style="{StaticResource EsriCheckBox}"/>

                        <CheckBox Grid.Row="1"
                                  Content="Clear WFS layer before loading"
                                  IsChecked="{Binding ClearWfsBeforeLoad}"
                                  Style="{StaticResource EsriCheckBox}"/>

                        <CheckBox Grid.Row="2"
                                  Content="Force map projection to Web Mercator (EPSG:3857)"
                                  IsChecked="{Binding ForceWebMercator}"
                                  Style="{StaticResource EsriCheckBox}"/>

                        <Grid Grid.Row="3" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="220"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="WFS Max Features:" Style="{StaticResource EsriLabel}" VerticalAlignment="Center"/>
                            <Slider Grid.Column="1" Minimum="100" Maximum="10000" Value="{Binding WfsMaxFeatures}" TickFrequency="100" IsSnapToTickEnabled="True" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" Text="{Binding WfsMaxFeatures}" Style="{StaticResource EsriTextBox}" IsReadOnly="True" Background="{StaticResource EsriBackground}" TextAlignment="Center"/>
                        </Grid>
                        
                        <Grid Grid.Row="4" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="220"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="150"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <CheckBox IsChecked="{Binding RequireMinZoomForWfs}"
                                          Style="{StaticResource EsriCheckBox}"/>
                                <TextBlock Text="Require minimum zoom to load WFS" Margin="6,0,0,0"/>
                            </StackPanel>

                            <Slider Grid.Column="1" Minimum="0.05" Maximum="5.0" Value="{Binding MinWfsViewWidthDegrees}" TickFrequency="0.05" IsSnapToTickEnabled="True" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Grid.Column="2" Text="{Binding MinWfsViewWidthDegrees, StringFormat='Min width: {0:F2}&#176;'}" Style="{StaticResource EsriTextBox}" IsReadOnly="True" Background="{StaticResource EsriBackground}"/>
                        </Grid>
                    </Grid>
                </GroupBox>

            </StackPanel>
        </ScrollViewer>

        <!-- Status/Action Bar -->
        <Border Grid.Row="2" 
                Background="{StaticResource EsriWhite}" 
                BorderBrush="{StaticResource EsriLightGray}" 
                BorderThickness="0,1,0,0" 
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="Configure settings for the Spherical Image Viewer add-in"
                           Style="{StaticResource EsriLabel}"
                           VerticalAlignment="Center"
                           FontStyle="Italic"
                           Foreground="{StaticResource EsriGray}"
                           Margin="0"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Apply Changes" 
                            Style="{StaticResource EsriButton}"
                            Command="{Binding SaveSettingsCommand}"
                            MinWidth="100"
                            Margin="0,0,8,0"/>
                    <Button Content="Cancel" 
                            Style="{StaticResource EsriSecondaryButton}"
                            Command="{Binding CloseSettingsCommand}"
                            MinWidth="80"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
